<!--keywords:音视频通话,采集音量,播放音量,耳返 -->
在音视频通话和互动直播过程中，为了提高产品使用者的体验，网易云信 NERTC SDK 支持调整各种声音的音量，例如调整 SDK 采集的声音、播放的声音等。音量调节功能适用于多种需要自定义调节音量的场景。

NERTC SDK 也支持通过 **监听回调** 的方式获取房间内成员的音量。在一些语音连麦场景或者视频会议场景中，产品应用层常常需要 **获取发言者的音量**，并通过 UI 进行音量展示，或者根据发言者的音量大小进行视图布局的动态调整。详细信息请参考 <a href="https://doc.yunxin.163.com/nertc/guide/zgxOTkwOTY?platform=harmonyos" target="_blank">监测发言者音量</a>。

本文将在末尾为您介绍 NERTC SDK 相关 **音频接口** 的实现原理和适用场景，具体内容请参考下文 [音频主要接口对比](#音频主要接口对比) 查看。文中部分 API 在 1.0.0 Beta 版本中暂未开放，如果您有相关需求，请联系网易云信技术支持工程师。

## <span id="设置采集音量">设置采集音量</span>

NERTC SDK 通过录音设备采集房间内成员的音频信号，将其录制下来以后播放给远端用户收听。

### 技术原理

<img alt="采集.png" src="https://yx-web-nosdn.netease.im/common/78660b7ea330656a0a4373ebc5d86698/采集.png" style="width:80%">

### 实现方法

调用 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustRecordingSignalVolume" target="_blank">`adjustRecordingSignalVolume`</a> 方法设置录制声音的信号幅度，从而达到调节采集音量的目的。

该方法通过 `volume` 参数设置录音信号的音量，取值范围为 0 ~ 400：

- 0: 静音。
- 100: （默认值）原始音量，即不对信号做缩放。
- 400: 原始音量的 4 倍，即把信号放大到原始信号的 4 倍。

    ::: note note
    建议设置采集音量时使用默认值（100）或小于该值，否则可能会导致音质问题。
    :::

    **示例代码** 如下：

    ```typescript
    //将采集音量设置为 100
    NERtcSDK.getInstance().adjustRecordingSignalVolume(100);
    ```

## <span id="设置播放音量">设置播放音量</span>

在音视频通话过程中，音频信号从发送端进入到接收端，然后使用播放设备进行播放。

### 技术原理

<img alt="设置播放音量-移动端.png" src="https://yx-web-nosdn.netease.im/common/61f9bd3f1c2624723f739dcbb05e8003/设置播放音量-移动端.png" style="width:80%">

### 实现方法

有三种方法调节播放声音的信号幅度，从而达到调节播放音量的目的。三种方法的区别和适用场景如下表所示。

接口 | 生效的对象 | 调用时机
---- | ---- | ----
<a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustPlaybackSignalVolume" target="_blank">`adjustPlaybackSignalVolume`</a> | 本地播放的所有远端用户的音频流。 | 本端用户加入房间前后均可调用。<br>远端用户进入房间之前，就可以控制音量。
<a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustUserPlaybackSignalVolume" target="_blank">`adjustUserPlaybackSignalVolume`</a> | 本地播放的某个远端用户的音频流。 | 本端用户加入房间后且对应的远端用户进入房间后调用。 |
`adjustChannelPlaybackSignalVolume` | 某个房间内的所有远端用户的音频流。<br>在多房间场景中，可以使用该方法单独调整主房间或者某个子房间的所有远端用户的播放音量。 | 本端用户加入房间前后均可调用。<br>远端用户进入房间之前，就可以控制音量。 |

::: note note
如果您在 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustPlaybackSignalVolume" target="_blank">`adjustPlaybackSignalVolume`</a>、`adjustChannelPlaybackSignalVolume` 和 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustUserPlaybackSignalVolume" target="_blank">`adjustUserPlaybackSignalVolume`</a> 中都设置了音量，实际输出的音量值为 **adjustPlaybackSignalVolume 音量值 × adjustChannelPlaybackSignalVolume 音量值 × adjustUserPlaybackSignalVolume 音量值**。例如 adjustPlaybackSignalVolume 中的音量值设为 100，adjustChannelPlaybackSignalVolume 中的音量值设为 90，adjustUserPlaybackSignalVolume 中的音量值设为 70，实际输出音量为**100% × 90% × 70% = 63%**。
:::

- 调用 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustPlaybackSignalVolume" target="_blank">`adjustPlaybackSignalVolume`</a> 方法可以调节本地播放的所有远端用户的音量。

    参数说明如下表所示。

    参数 | 类型 | 描述
    ---- | ---- | ----
    volume | number | 播放音量的百分比，取值范围为 [0,400]。<ul><li>0：静音。<li>100：原始音量。<li>400：原始音量的 4 倍（自带溢出保护）。

    ::: note note
    建议设置本地播放音量时使用默认值（100）或小于该值，否则可能会导致音质问题。
    :::

    **示例代码** 如下：

    ```typescript
    //调整本地播放的所有远端用户的播放音量为 50
    NERtcSDK.getInstance().adjustPlaybackSignalVolume(50);
    //调整本地播放的所有远端用户的播放音量为 0，静音所有用户
    NERtcSDK.getInstance().adjustPlaybackSignalVolume(0);
    ```

- 调用 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustUserPlaybackSignalVolume" target="_blank">`adjustUserPlaybackSignalVolume`</a> 方法可以调节本地播放的指定远端用户的音量。

    参数说明如下表所示。

    参数 | 类型 | 描述
    ---- | ---- | ----
    uid | bigint | 远端用户的 ID。
    volume | number | 播放音量的百分比，取值范围为 [0,100]。<ul><li>0：静音。<li>100：原始音量。

    ::: note note
    多次调用该方法，可以设置不同远端用户的播放音量。也可以反复调节某个远端用户的播放音量。
    :::

    **示例代码** 如下：
    ```typescript
    //调整本地播放的 uid 为 12345 的用户的播放音量为 50
    NERtcSDK.getInstance().adjustUserPlaybackSignalVolume(12345, 50);
    //调整本地播放的 uid 为 12345 的用户的播放音量为 0，静音该用户。
    NERtcSDK.getInstance().adjustUserPlaybackSignalVolume(12345, 0);
    ```
- 调用 `adjustChannelPlaybackSignalVolume` 方法可以调节本地播放的指定房间内所有远端用户的音量。

    参数说明如下表所示。

    参数 | 类型 | 描述
    ---- | ---- | ----
    volume | number | 播放音量的百分比，取值范围为 [0,400]。<ul><li>0：静音。<li>100：原始音量。<li>400：原始音量的 4 倍（自带溢出保护）。

    ::: note note
    - 建议设置本地播放音量时使用默认值（100）或小于该值，否则可能会导致音质问题。
    - 如果是调整主房间音量，请调用 `NERtc` 类下面的 `adjustChannelPlaybackSignalVolume`。
    - 如果是调整子房间音量，请调用 `NERtcChannel` 类下面的 `adjustChannelPlaybackSignalVolume`。
    :::

    **示例代码** 如下：
    ```typescript
    //调整本地播放的主房间内所有用户的播放音量为 50
    NERtcSDK.getInstance().adjustChannelPlaybackSignalVolume(50);

    //调整本地播放的子房间 1 所有用户的播放音量为 50
    mRtcChannel.adjustChannelPlaybackSignalVolume(50);
    ```

## <span id="设置耳返音量">设置耳返音量</span>

NERTC SDK 通过录音设备采集房间内成员的音频信号，然后使用播放设备进行播放，实现耳返功能。

### 技术原理

<img alt="耳返.png" src="https://yx-web-nosdn.netease.im/common/b94410e5515985815304d317274f187d/耳返.png" style="width:50%">

### 实现方法

调用 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#enableEarback" target="_blank">`enableEarback`</a> 方法开启耳返功能之后，您可以调用 <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#setEarbackVolume" target="_blank">`setEarbackVolume`</a> 方法设置耳返音量。

**示例代码** 如下：

```typescript
//将耳返音量设置为 100
NERtcSDK.getInstance().setEarbackVolume(100);
```
## <span id="音频主要接口对比">音频主要 API 对比</span>

| <div style="width:190px">接口名称</div> | <div style="width:140px">功能及适用场景</div> | <div style="width:100px">实现原理图解</div> |
| --- | --- | --- |
| <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#enableLocalAudio" target="_blank">enableLocalAudio</a> | 开启或关闭本地音频采集和发送 | <img alt="enablelocalaudio.png" src="https://yx-web-nosdn.netease.im/common/44f646facce3acb50b48ff2974d5d3ed/enablelocalaudio.png" style="width:50%"> |
|^^ | 适用于简单的音频开关场景 | ^^ |
| [enableMediaPub](https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#enablemediapub) | 开启或关闭本地媒体流（主流）的发送 | <img alt="enablemediapub.png" src="https://yx-web-nosdn.netease.im/common/f3c53580398d7aee8e9dd94bfbe235b4/enablemediapub.png" style="width:50%"> |
| ^^ | 适用于单独开启麦克风但不发送音频的场景，例如 **会议** 场景、**大房间** | ^^ |
| <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#muteLocalAudioStream" target="_blank">muteLocalAudioStream</a> | 开启或关闭本地音频主流的发送 | <img alt="mutelocalaudio.png" src="https://yx-web-nosdn.netease.im/common/cca453abf8387a51a0cab2f8f054a87b/mutelocalaudio.png" style="width:50%"> |
| ^^ | 适用于需要 **频繁** 静音\取消静音操作的场景 | ^^ |
| <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#setRecordDeviceMute" target="_blank">setRecordDeviceMute</a> | 静音音频采集设备 | <img alt="setRecordDeviceMute.png" src="https://yx-web-nosdn.netease.im/common/c3e3edb8a1cb1739cfaa2373231fde46/setRecordDeviceMute.png" style="width:50%"> |
| ^^ | 适用于麦克风采集和伴音同时开启时，只发送 **伴音** 音频的场景 | ^^ |
| <a href="https://doc.yunxin.163.com/docs/interface/nertc/harmonyos/typedoc/Latest/zh/interfaces/NERtc.NERtc.html#adjustRecordingSignalVolume" target="_blank">adjustRecordingSignalVolume</a> | 调节采集信号音量 | <img alt="adjustRecordingSignalVolume.png" src="https://yx-web-nosdn.netease.im/common/91483823a8357d5fbb3f9f2301491bb5/adjustRecordingSignalVolume.png" style="width:50%"> |
| ^^ | 适用于需要精确调整本地音频采集（包括外部输入）音量的场景，例如 **KTV**、**语聊房** | ^^ |