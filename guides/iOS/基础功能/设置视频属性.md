<!--keywords:音视频通话,设置视频属性,分辨率,帧率,码率-->

不同场景对于视频清晰度、流畅性等方面的要求各有不同，您需要根据场景调整合适的分辨率、码率、帧率等，以便给用户最优的通话体验。


## 功能描述 

NERTC SDK 支持调用<a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a96eeaa48e5900c00f408182b38c56b58" target="_blank">`setLocalVideoConfig`</a> 方法的  <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html" target="_blank">`config`</a> 和 <a href="https://doc.yunxin.163.com/docs/interface/NERTC_SDK/Latest/Android/html/enumcom_1_1netease_1_1lava_1_1nertc_1_1sdk_1_1video_1_1_n_e_rtc_video_stream_type.html" target="_blank">`streamType`</a> 参数，自定义设置**主流和辅流**的视频编码属性，包括分辨率、码率、帧率、带宽受限时的适应性偏好等。


-   <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html#aad45c14af27c85ee257e7c42f3546eb9" target="_blank">**`degradationPreference`**</a> ：设置带宽受限时视频编码的适应性偏好。

- <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html#a786967803a89d177432491d4577d3f8e" target="_blank">**`orientationMode`**</a> ：设置本地视频编码的旋转方向模式。

- <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_canvas.html#aef9343efe9f21931144b01c3286d6d86" target="_blank">**`mirrorMode`**</a> ：设置视频编码的镜像模式




## 前提条件

请确保已在项目中实现了基本的音视频通信或直播功能。

## <span id="iOS注意事项">注意事项</span>

- 本文中各参数的设置可能会影响计费。
- NERTC SDK 会根据实时网络环境，对设置的参数作自适应调整，通常会下调参数。
- NERTC SDK 支持在加入房间通话中后，您根据实际场景变化**动态调用** <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a96eeaa48e5900c00f408182b38c56b58" target="_blank">`setLocalVideoConfig`</a> 方法。
- <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a96eeaa48e5900c00f408182b38c56b58" target="_blank">`setLocalVideoConfig`</a> 为全量参数配置接口，重复调用此接口时，SDK 会刷新此前的所有参数配置，以最新的传参为准。所以每次修改配置时都需要设置所有参数，未设置的参数将取默认值。

## <span id="iOS设置视频编码分辨率、码率和帧率">设置视频编码分辨率、码率和帧率</span>

您可以通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a96eeaa48e5900c00f408182b38c56b58" target="_blank">`setLocalVideoConfig`</a> 方法中的如下参数，自定义视频编码的分辨率、码率和帧率。


参数 | 说明 | 
---- | -------------- | 
<a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html#a32b18b81f7b257594a697dc1351d569b" target="_blank">**`width`**</a> 和 <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html#ac5e2281804c203bb67fbcd297ac95088" target="_blank">**`height`**</a>|视频编码的分辨率。单位为 px 。用来衡量编码质量，通常情况下分辨率越高，视频越清晰。<br>默认为 640 x 360，取值范围为64 x 64 ~ 1920 x 1080，如果设置取值范围以外的数值，则保持默认设置，即 640 x 360。| 
<a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_base_video_encode_configuration.html#a5f3e81b29fcc10824af50605d14404f1" target="_blank">**`frameRate`**</a> |视频编码帧率（fps）。指每秒钟编码多少帧画面。<ul><li>在通信模式下，建议您将帧率设置为 24 fps，用户在视觉上不会出现卡顿现象。<li>在直播模式下，建议您将帧率适当降低至 15 fps，保证直播画面的高清晰度。|
<a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_base_video_encode_configuration.html#a0e543671326dca52177607871c054337" target="_blank">**`bitrate`**</a> | 视频码率（Bitrate），单位为 kbps。指每秒钟编码器输出多少 Kbit 的编码后的二进制数据。<br> 推荐使用默认码率， SDK 会根据场景属性、分辨率和帧率自动设置合适的码率。若您对画面清晰度有更高的要求，推荐将码率提升至默认码率的 1.2 倍。| 

  

::: note note
此处设置的数值均为理想情况下的最大值，实际场景中，如果视频引擎因网络环境或设备采集能力等原因无法达到设置的分辨率、帧率或码率的最大值时，会根据设备采集能力自动向下取值。
:::


视频的分辨率、码率和帧率并不是越高越好，三者之间需要维持一个平衡的映射关系关系，您可以参考[分辨率、帧率和码率参照表](#分辨率-帧率和码率参照表)设置分辨率和码率。

### 典型场景的推荐配置

典型场景的视频参数推荐配置请参见[音视频参数配置推荐](https://doc.yunxin.163.com/nertc/guide/zI4NjEyMTA?platform=android)。





## <span id="iOS设置适应性偏好">设置带宽受限的适应性偏好</span>

在弱网环境下，视频的清晰度和流畅度可能无法兼顾，为保证音视频通话或互动直播场景下的视频体验，您可以通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html#aad45c14af27c85ee257e7c42f3546eb9" target="_blank">**`degradationPreference`**</a> 参数设置带宽受限时视频编码的适应性偏好。


| <div style="width:120px">参数</div> | 描述 |
|---|---|
| kNERtcDegradationBalanced | 在编码帧率和视频质量之间保持平衡。 |
| kNERtcDegradationDefault | 根据场景模式调整适应性偏好。<br>通信场景中，选择 kNERtcDegradationBalanced 模式，在编码帧率和视频质量之间保持平衡。<br>直播场景中，选择 kNERtcDegradationMaintainQuality 模式，降低编码帧率以保证视频质量。 |
| kNERtcDegradationMaintainFramerate | 流畅优先，降低视频质量以保证编码帧率。在弱网环境下，降低视频清晰度以保证视频流畅，此时画质降低，画面会变得模糊，但可以保持视频流畅。 |
| kNERtcDegradationMaintainQuality | 清晰优先，降低编码帧率以保证视频质量。在弱网环境下，降低视频帧率以保证视频清晰，此时可能会出现一定卡顿。 |



## <span id="iOS设置镜像模式">设置镜像模式</span>

您可以通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_encode_configuration.html#a685544b623e1ee5627bdafbe9d014ce6" target="_blank">**`mirrorMode`**</a> 参数来设置视频编码的镜像模式，影响远端用户看到的视频画面。

默认情况下，编码时由 SDK 决定镜像模式。移动端如果使用前置摄像头，则默认开启镜像模式；如果使用后置摄像头，则关闭镜像模式。

<note type="note">NERTC SDK 还支持在设置画布时调整本地和远端视频画面的镜像模式，即画面是否左右翻转。本地设置的视频镜像模式仅影响本地用户所见，不影响远端用户所见。NERtcVideoCanvas 中的 <a href="https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_video_canvas.html#aef9343efe9f21931144b01c3286d6d86" target="_blank">`mirrorMode`</a> 设置为 `kNERtcVideoMirrorModeEnabled` 表示开启镜像模式。</note>


## 示例项目源码
网易云信提供 [视频属性的示例项目源码 SetVideoQuality](https://github.com/netease-im/G2-API-Examples/tree/main/ios/Advanced/SetVideoQuality)，您可以参考该源码配置视频属性。


## <span id="iOS示例代码">示例代码</span>

```objective-c
NERtcEngine *coreEngine = [NERtcEngine sharedEngine];
NERtcVideoEncodeConfiguration *config = [[NERtcVideoEncodeConfiguration alloc] init];
NERtcStreamChannelType *streamType = kNERtcStreamChannelTypeMainStream; //设置主流
config.width = 640;// 设置分辨率宽
config.height = 360;// 设置分辨率高
config.cropMode = kNERtcVideoCropMode16_9;      // 设置裁剪格式为16:9
config.frameRate = kNERtcVideoFrameRateFps30; //视频帧率
config.minFrameRate = mMinFrameRate; //视频最小帧率
config.bitrate = mBitrate; //视频编码码率
config.minBitrate = mMinBitrate; //视频编码最小码率
config.degradationPreference = kNERtcDegradationDefault; ;//带宽受限时的视频编码降级偏好

[coreEngine setLocalVideoConfig:config,streamType];//设置本地视频参数

[coreEngine enableDualStreamMode:mVideoDual];//是否开启小流
```

## 相关参考

### <span id="分辨率、帧率和码率推荐表">分辨率、帧率和码率参照表</span>

在大多数场景下，您可以根据实际业务场景中的视频窗口的大小去配置分辨率、帧率、码率，以控制带宽压力及编解码的资源消耗。
在自定义视频编码参数的过程中，您也可以参考下表对这些参数进行自定义配置。

::: note note
下表中的视频参数推荐仅适用于 Native 端，即 Android、iOS、Windows、macOS 平台。
:::

|**分辨率**|**帧率（fps）**|**通信场景码率(kbps)**|**直播场景码率(kbps)**|
|:--|:--|:--|:--|
|90 x 90|30|49|73|
|90 x 90|15|32|48|
|120 x 90|30|61|91|
|120 x 90|15|40|60|
|120 x 120|30|75|113|
|120 x 120|15|50|75|
|160 x 90|30|75|113|
|160 x 90|15|50|75|
|160 x 120|30|94|141|
|160 x 120|15|62|93|
|180 x 180|30|139|208|
|180 x 180|15|91|137|
|240 x 180|30|172|259|
|240 x 180|15|113|170|
|240 x 240|30|214|321|
|240 x 240|15|141|212|
|320 x 180|30|214|321|
|320 x 180|15|141|212|
|320 x 240|30|259|389|
|320 x 240|15|175|263|
|360 x 360|30|393|590|
|360 x 360|15|259|389|
|424 x 240|15|217|325|
|480 x 360|30|488|732|
|480 x 360|15|322|483|
|480 x 480|30|606|909|
|480 x 480|15|400|600|
|640 x 360|30|606|909|
|640 x 360|15|400|600|
|640 x 480|30|752|1128|
|640 x 480|15|496|744|
|720 x 720|30|1113|1670|
|720 x 720|15|734|1102|
|848 x 480|30|929|1394|
|848 x 480|15|613|919|
|960 x 720|30|1382|2073|
|960 x 720|15|911|1367|
|1080 x 1080|30  |2046|3069|
|1080 x 1080|15|1350|2025|
|1280 x 720|30|1714|2572|
|1280 x 720|15|1131|1697|
|1440 x 1080|30|2538|3808|
|1440 x 1080|15  |1675|2512|
|1920 x 1080|30|3150|4725|
|1920 x 1080|15|2078|3117|

### <span id="常见问题">常见问题</span>

- <a href="https://doc.yunxin.163.com/docs/jcyOTA0ODM/jcxMzE3MTE?platformId=50192#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%85%B3%E9%97%AD%E6%91%84%E5%83%8F%E5%A4%B4%E5%90%8E%E9%87%8D%E6%96%B0%E6%89%93%E5%BC%80%EF%BC%8C%E5%8E%9F%E6%9D%A5%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%90%8E%E7%BD%AE%E6%91%84%E5%83%8F%E5%A4%B4%E5%8F%98%E6%88%90%E4%BA%86%E5%89%8D%E7%BD%AE%EF%BC%9F" target="_blank">为什么我关闭摄像头后重新打开，原来设置的后置摄像头变成了前置？</a>

- **分辨率是越高越好吗？**

    分辨率不是越高越好，较高的分辨率需要有较高的码率来支撑。高分辨率、高码率会提供高质量的视频，但同时会增加对宽带的压力，可能导致视频卡顿。建议您根据实际场景选择对应的分辨率，具体请参考[音视频参数配置推荐](https://doc.yunxin.163.com/nertc/guide/DY5Njk1OTc?platform=iOS)，如果需要自定义分辨率，请参考[分辨率、帧率和码率参照表](#分辨率、帧率和码率参照表)设置合理的值。