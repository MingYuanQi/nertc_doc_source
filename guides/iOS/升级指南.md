本文介绍 NERTC SDK 5.X.X 版本，iOS 端升级的说明和注意事项。

## 5.6.50

从 5.6.50 版本起，已支持 XCFramework。XCFramework 是 Apple 在 Xcode 11 中引入的一种新的框架格式，用于简化和优化在不同平台（如 iOS、macOS、watchOS 和 tvOS）上使用的二进制库的管理和分发。

从 5.6.40 升级至 5.6.50 版本，如果您需要 [手动集成 NERTC SDK](https://doc.yunxin.163.com/nertc/guide/TM5NzI5MjI?platform=iOS#%E6%96%B9%E5%BC%8F%E4%BA%8C%E6%89%8B%E5%8A%A8%E9%9B%86%E6%88%90)，请重新添加 XCFramework 的依赖。

## 5.6.40

从 5.6.30 升级至 5.6.40 版本，针对构建了多房间功能的用户需注意，多房间场景下的接口行为变更如下：

- 本地音频采集和发送接口 [`enableLocalAudio`](https://doc.yunxin.163.com/nertc/references/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a45c2df7b6d207e730c722b56540e588c) 打开音频设备时，互斥修改为不互斥。
- 本地媒体流（主流）的发送接口 [`enableMediaPub`](https://doc.yunxin.163.com/nertc/references/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a3803d4ac8c8fb620b68094de06b07998) 发布音频流时，不互斥修改为互斥。

即在多房间下实现发送音频流，如果只需保持设备按需开启，您需要：

1. 先关闭上一个房间的音频流，即 `enableMediaPub`=`false` / `enableLocalAudio`=`false`。
2. 然后在当前房间实现发送音频数据流，即 `enableMediaPub`=`true` / `enableLocalAudio`=`true`。

在多房间下实现发送音频流，如果需要音频采集设备一直开启，您需要：

1. 在成员加入每个房间前，调用一次 `enableLocalAudio`。
2. 后续音频流发布到具体的房间只需由 `enableMediaPub` 控制。

## 5.5.10

从 5.5.2 升级至 5.5.10 版本，涉及如下接口变更，您需要结合实际业务场景更新相关的 App 代码：

**接口名称变更**

| 功能 | 原接口 | 新接口 | 集成修改建议 |
| ---- | ---- | ---- | ---- |
| 设置空间音效的距离衰减属性和语音范围 | `UpdateSpatializerAudioRecvRange` | [`setAudioRecvRange`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a6eabcbb2eeca509e6d252f2301dab4f8) | 若您使用了 **空间音效** 功能，请修改代码中对应的接口名称。
| 设置空间音效中说话者和接收者的空间位置信息 | `UpdateSpatializerSelfPosition` | [`updateSelfPosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a2b333216ce41f6af09b9af142f023204) | ^^
| 空间位置信息 | `NERtcSpatializerPositionInfo` | [`NERtcPositionInfo`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/interface_n_e_rtc_position_info.html) | 若您使用了 **空间音效** 功能，请修改代码中对应的结构体名称。

**接口行为变更**

| 变更描述 | 集成修改建议 |
| ---- | ---- |
| 切换房间（`switchChannel`）。在直播场景中，原先只支持观众切换房间，修改为主播和观众都支持切换房间，并且切换后会保持切换前的音视频的状态。 | 请检查房间切换前后的音视频状态是否符合预期。 |
| `onFirstVideoFrameDecoded` 回调的触发时机修改，当重新调用 `enableLocalVideo` 开启本地视频采集，或停止屏幕共享后再重新调用 `startScreenCapture` 接口共享屏幕时，都会触发该回调。 | 不影响 |

## 5.3.1

从 4.6.X 升级至 5.3.1 版本，涉及如下接口变更，您需要结合实际业务场景更新相关的 App 代码：

**接口行为变更**

| 变更描述 | 集成修改建议 |
| ---- | ---- |
| 支持在不开麦的状态下开启伴音功能。 | 若您在 [`setParameters`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a2a674564c41bbd4b5556f08a9d65a558) 中设置了不开麦状态下开启伴音功能(`kNERtcKeyAudioMixSendEnabledWithoutMic`)，请删除相关代码片段即可。 |
| 观众调用 `addLiveStreamTask` 方法添加房间推流任务，无需跟服务器进行信令交互，直接返回 30005。 | 根据返回的 30005 错误码直接判断当前角色不正确。 |
| 设置画布缩放模式接口 [`setLocalRenderScaleMode`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#ade23688425ac543bee53e64e63d97f32)/ [`setRemoteRenderScaleMode`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a29a87b34823ca7d9f70d4308a365fc9e) 仅可在调用 [`setupLocalVideoCanvas`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a8563cf11b4be079a21d7854b2369c94b)/[`setupRemoteVideoCanvas`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a075252ab6d8eb1776e7206c235a72ca8) 接口设置画布之后才生效。 | <ul><li>设置画布前无需设置画布缩放模式。<li>设置画布时可以通过 [`setupLocalVideoCanvas`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a8563cf11b4be079a21d7854b2369c94b)/[`setupRemoteVideoCanvas`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a075252ab6d8eb1776e7206c235a72ca8) 接口设置缩放模式。<li>设置画布后可以再通过[`setLocalRenderScaleMode`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#ade23688425ac543bee53e64e63d97f32) /[`setRemoteRenderScaleMode`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_channel-p.html#a29a87b34823ca7d9f70d4308a365fc9e) 接口更新缩放模式。 |
| 日志的默认存放路径变更。 | iOS 端的默认日志路径调整为：`~/Documents/Logs`。

**接口参数变更**

| 变更描述 | 集成修改建议 |
| ---- | ---- |
| 编码水印 `setLocalVideoWatermarkConfigs` 接口中，`NERtcVideoWatermarkTextConfig` 和 `NERtcVideoWatermarkTimestampConfig` 结构体里的 `fontPath` 名字改为 `fontName`。 | 若您使用了 **编码水印** 功能，请修改代码中对应的参数。 | 