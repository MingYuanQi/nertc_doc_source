<!--keywords:音视频通话,摄像头切换,闪光灯,对焦,曝光 -->

在各种视频的业务场景中，用户经常会需要调整设备的摄像头，例如调整曝光、对焦和闪光灯等功能设置，使被摄物体成像清晰、亮度适宜。 NERTC SDK 提供整套的摄像头管理方法，以便用户灵活切换前、后置摄像头，并对摄像头进行缩放、对焦和曝光等相关配置。

## 功能介绍

NERTC SDK 提供相关接口，支持检测拍摄相关设备的能力，例如检测是否支持闪光灯常开等。同时支持多种摄像头相关的设置方法，包括：
- 摄像头相关：
    - 摄像头缩放：支持动态调整缩放比例。
    - 摄像头切换：支持切换或指定前后置摄像头。
- 闪光灯：支持开关闪光灯。
- 对焦：支持手动选择对焦位置，摄像头自动对焦。
- 曝光：支持手动选择曝光区域，摄像头自动曝光。

## 注意事项

- 部分设备可能不支持开启闪光灯或摄像头缩放，直接调用接口调节设备可能会失败。因此用户操作前应先调用相关检测接口，判断当前设备是否支持调整设备的相关设置。
- 请在相机启用后再调用视频设备相关的设置方法，例如在调用 [`startPreview`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a39334f2aeb02faba230d81afcda1e807) 方法或 [`joinChannelWithToken`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#adf60d9392e4b50ff73872138965f022f) 方法后。

## 摄像头缩放

### 配置步骤

1. 调用 [`isCameraZoomSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a00c40f0f97f66fba3d89296f9d0d799c)，检测设备是否支持摄像头缩放功能。
2. 调用 [`setCameraZoomFactor`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a3478af2e000b4d538d57f297e1ef1e32) 方法设置具体需要的缩放比例，可在通话过程中动态调整。

    ::: note note
    在设置需要的摄像头缩放比例前，您可以调用 [`maxCameraZoomScale`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#acb04287a7c8606f971ae7fafe1430dac) 方法获取设备支持的最大缩放比例。
    :::
    
### 示例代码

```
//检测设备是否支持摄像头缩放
BOOL supported = [[NERtcEngine sharedEngine] isCameraZoomSupported];

// 设置摄像头缩放比例
CGFloat scale = self.curVideoScale * pinchScale;
scale = MAX(1, scale); // > 1
scale = MIN(scale, [self.engine maxCameraZoomScale])
[[NERtcEngine sharedEngine] setCameraZoomFactor:scale];
```

## 摄像头切换

### 配置步骤

- 调用 [`switchCamera`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a34309b13dc0107b607cf6e93c8b7f6b9) 方法在前置摄像头和后置摄像头之间切换，通话过程中也可随时切换。
- 调用 [`switchCameraWithPosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#aa1a2d466870a39e06a513544731c33ec) 方法指定使用前置（kNERtcCameraPositionFront）或后置摄像头（kNERtcCameraPositionBack），通话过程中也可随时指定。

::: note note
- 若切换摄像头后的最大分辨率不支持设置的编码参数，SDK 会根据设备实际支持的分辨率，调整编码的实际分辨率和对应的实际码率。
- V5.3.0 及之后版本，子房间支持调用 `NERtcChannel#switchCamera` 或 `NERtcChannel#switchCameraWithPosition` 切换摄像头。

:::

### 示例代码
```
// 切换前后摄像头
[[NERtcEngine sharedEngine] switchCamera];
 
//指定前置摄像头
[[NERtcEngine sharedEngine] switchCameraWithPosition:kNERtcCameraPositionFront] 
```

## 开关闪光灯

### 配置步骤

1. 调用 [`isCameraTorchSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a6d38e638fcab88388e66deef1db5eda3) 方法，检测设备是否支持闪光灯常开。
    ::: note note 
    - 一般情况下，App 默认开启前置摄像头，因此如果设备的前置摄像头不支持闪光灯，直接调用此方法会返回 NO（表示不支持闪光灯常开）。
    - 若您需要检查后置摄像头是否支持闪光灯，需要先调用 [`switchCamera`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a34309b13dc0107b607cf6e93c8b7f6b9) 方法切换至后置摄像头或调用 [`switchCameraWithPosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#aa1a2d466870a39e06a513544731c33ec) 方法指定使用后置摄像头，再调用此方法。
    :::
2. 调用 [`setCameraTorchOn`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#af635f1db2ac36ef2f05dc2a3d69cd621) 开关闪光灯，通话过程中也可随时开关。


### 示例代码

```
// 检测设备是否支持闪光灯常开
BOOL supported = [[NERtcEngine sharedEngine] isCameraTorchSupported];

//检测设备是否已开启闪光灯
BOOL isTorchOn = [[NERtcEngine sharedEngine] isCameraTorchOn];

// 开关闪光灯
int result = [[NERtcEngine sharedEngine] setCameraTorchOn:!isTorchOn];
```

## 手动对焦

### 配置步骤

1. 调用 [`isCameraFocusSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a35e69b6b9e7aa0cf12b60a0125ce912c) 方法，检测设备是否支持手动对焦。
2. 调用 [`setCameraFocusPosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a4adb9974317a178f724e51d43e645b2f) 方法设置手动对焦位置并触发对焦。相关参数说明如下：
    - focusX：触摸点相对于视图的横坐标，取值范围为 0 ~ 1。
    - focusY：触摸点相对于视图的纵坐标，取值范围为 0 ~ 1。
    ::: note note
    对焦点区域面积对测光和对焦都有影响，用户应根据需要调整对焦点区域面积。
    :::
### 示例代码

```
// 检测设备是否支持手动对焦
BOOL supported = [[NERtcEngine sharedEngine] isCameraFocusSupported];

// 设置手动对焦位置
CGPoint point = [tap locationInView:self.previewContainer];
float x = point.x / CGRectGetWidth(self.previewContainer.bounds);
float y = point.y / CGRectGetHeight(self.previewContainer.bounds);
[[NERtcEngine sharedEngine] setCameraFocusPositionX:x Y:y];  
```

## 手动曝光

### 配置步骤

1. 调用 [`isCameraExposurePositionSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a4adb9974317a178f724e51d43e645b2f) 方法，检测设备是否支持手动曝光功能。
2. 调用 [`setCameraExposurePosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a5a629ed7aac32c4a679c1ba635cbc665) 方法设置手动曝光位置并触发曝光。相关参数说明如下：
    - focusX：触摸点相对于视图的横坐标，取值范围为 0 ~ 1。
    - focusY：触摸点相对于视图的纵坐标，取值范围为 0 ~ 1。

### 示例代码

```
//检测设备是否支持手动曝光
BOOL supported = [[NERtcEngine sharedEngine] isCameraExposurePositionSupported];

// 设置手动曝光位置
[[NERtcEngine sharedEngine] setCameraExposurePosition:CGPointMake(0.5, 0.5)];
```

## API 参考
| **方法** | **功能描述**|
|:--|:--|
|[`isCameraZoomSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a00c40f0f97f66fba3d89296f9d0d799c)|是否支持摄像头缩放|
|[`setCameraZoomFactor`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a3478af2e000b4d538d57f297e1ef1e32)|设置摄像头缩放比例|
|[`switchCamera`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine-p.html#a34309b13dc0107b607cf6e93c8b7f6b9)|切换前后置摄像头|
|[`switchCameraWithPosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#aa1a2d466870a39e06a513544731c33ec)|指定前后置摄像头|
|[`isCameraTorchSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a6d38e638fcab88388e66deef1db5eda3)|是否支持闪光灯常开|
|[`setCameraTorchOn`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#af635f1db2ac36ef2f05dc2a3d69cd621)|开关闪光灯|
|[`isCameraFocusSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a35e69b6b9e7aa0cf12b60a0125ce912c)|是否支持手动对焦|
|[`setCameraFocusPosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a4adb9974317a178f724e51d43e645b2f)|设置手动对焦位置|
|[`isCameraExposurePositionSupported`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a4adb9974317a178f724e51d43e645b2f)|是否支持手动曝光|
|[`setCameraExposurePosition`](https://doc.yunxin.163.com/nertc/api-refer/iOS/doxygen/Latest/zh/html/protocol_i_n_e_rtc_engine_ex-p.html#a5a629ed7aac32c4a679c1ba635cbc665)|设置手动曝光位置|


