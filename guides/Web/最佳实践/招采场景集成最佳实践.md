招采场景是指企业或组织通过公开招标、邀请招标等方式，从多个供应商中选择最优合作伙伴，以采购所需商品、服务或工程的过程。这一过程通常包括需求分析、市场调研、编制和发布招标文件、接收投标、开标与评标、谈判、确定中标者、签订合同以及执行和验收等多个环节，旨在确保采购活动的透明度、公平性和效率。本文介绍了如何通过网易云信音视频通话 2.0 NERTC Web SDK 搭建网页版远程异地评标系统。

## 业务场景

为了推动数字化采购改革以及企业数字化采购转型，国务院办公厅、财政部、国资委、工信部等部门已出台一系列关键政策。国务院办公厅 **21 号文** 明确指出要改进评标方法和评标机制，全面推广远程异地评标形式。多地政府已积极响应政府要求完成远程异地评标系统建设，通过电子化平台和远程异地评标等手段，来提高操作便捷性和公正性。

常见的招采业务场景如下图所示：

<img alt="image.png" src="https://yx-web-nosdn.netease.im/common/947ef8f94ae61ce58fbd7d8a206ed1d5/image.png" style="width:80%;border: 1px solid #BFBFBF;">

## 方案架构

网易云信具备一套全面的通信与视频服务解决方案，能够为招采场景提供高效、安全实时音视频（RTC）功能，如下图所示。方案支持远程沟通、在线谈判、视频会议等关键环节，从而提升采购过程的透明度、互动性和效率，同时确保数据的安全性和合规性，满足现代招采平台对于实时交互和协同工作的高要求。

<img alt="image.png" src="https://yx-web-nosdn.netease.im/common/f3fdb22784ac9582747ae2ad3ad37e53/image.png" style="width:80%;border: 1px solid #BFBFBF;">

## 功能介绍

远程异地评标系统是一种利用现代信息技术手段，实现评标专家在不同地理位置上进行协同工作的平台。这种系统旨在提高评标的公正性、透明度和效率，同时减少传统评标过程中可能出现的人为干扰。

<img alt="image.png" src="https://yx-web-nosdn.netease.im/common/0959c1fda62c6d4dbe4c6b44790749cc/image.png" style="width:60%;border: 1px solid #BFBFBF;">

根据上图，远程异地评标系统涉及的业务场景需求和对应的网易云信产品功能如下表所示：

| <div style="width: 100px">功能项</div> | 业务场景需求 | 涉及网易云信能力项 |
| --- | --- | --- |
| 用户身份认证 | <ul><li> 通过多种方式（如账号密码、双因素认证等）确保只有授权的评标专家可以登录系统。 </li><li> 实现严格的权限管理，确保每个用户的操作都在其权限范围内。 </li></ul> | N/A |
| 项目与文件管理 | <ul><li> 支持创建、编辑及发布招标项目。 </li><li> 提供投标文件的安全上传、下载和存储服务。 </li><li> 自动化处理文档，包括文件格式转换、加密解密等功能。 </li></ul> | N/A |
| 在线评标环境 | <ul><li> 为评标专家提供一个安全稳定的在线工作空间，包括实时浏览投标文件、填写评分表单、提交评审意见等功能。 </li><li> 支持多用户同时在线协作，保证评标过程的流畅进行。 </li></ul> | <ul><li> [音频变声](/nertc/guide/DU1MTA3ODM)：所有人互相听到声音，并且听到的是变声，避免原声泄露。 </li><li> [原声录制](/nertc/guide/TcyOTY1MzI) </li></ul> |
| 音视频会议支持 | <ul><li> 集成高清音视频通话功能，便于评标专家之间进行面对面交流。 </li><li> 支持屏幕共享、白板协作等工具，增强沟通效果。 </li><li> 记录会议过程，以便事后审查或存档。</li></ul> | <ul><li> [音视频通话](/nertc/guide/TA1NTk0NzY) </li><li> [屏幕共享](/nertc/guide/TkyODYxMTE) </li><li> [音视频权限管理](#setSubscribeConfig)：专家互相看不到，评委可以看到所有人。 </li></ul> |
| 电子签名与审批 | <ul><li> 允许评标专家对评标结果进行电子签名确认。 </li><li> 确保所有操作都有迹可循，符合法律法规要求。 </li></ul> | N/A |
| 数据安全保障 | <ul><li> 采用先进的加密技术，保护传输中的数据安全。 </li><li> 对敏感信息实施严格访问控制，防止未经授权的访问。 </li><li> 定期备份数据，确保数据不丢失。 </li></ul> | <ul><li> [媒体流加密](/nertc/guide/TE4MjYwMTU) </li><li> 入会密码 </li><li> 会议锁定 </li><li> [水印](/nertc/guide/jE3NzU5MDY) </li></ul> |
| 监督与审计 | <ul><li> 实时记录评标过程中的各项活动，形成完整的日志。 </li><li> 提供详细的审计报告，方便监管部门进行监督和审查。 </li><li> 支持异常行为检测，及时发现并处理潜在问题。 </li></ul> | <ul><li> [视频双录](/nertc/guide/jUxMTEzMDM)：每个专家单独一个录制文件，录制内容包括专家自己的屏幕共享及摄像头画面，并且包括所有人音频，便于留档保存。 </li><li> [点播回放](/vod/concept/Tc1MDUzNTY) </li></ul> |

## 环境推荐

接入远程异地评标系统的最低设备配置，如下表所示：

| <div style="width: 100px">设备配置</div> | 配置说明 |
| --- | --- |
| 网络带宽 | <ul><li> 专家：建议最低 2M，只发布不订阅，带宽占用不需要比较高。 </li><li> 评标人&监督人：建议最低 6M，需要订阅所有专家，带宽建议高一点。 </li></ul> |
| 浏览器 | 推荐使用谷歌 Chrome 浏览器。 <ul><li> 谷歌 Chrome 浏览器 72 及以上版本 </li><li> 苹果 Safari 浏览器 15.4 及以上版本 </li><li> Mozilla Firefox 浏览器最新（120）版本 </li><li> Microsoft Edge 浏览器最新（119）版本 </li></ul><note type="note">如果使用媒体流加密的自定义加密，仅 Chrome94 及以上版本的浏览器支持此功能。</note> |
| 设备性能 | <ul><li> 专家：建议设备内存 6G 及以上。 </li><li> 评标人&监督人：建议设备内存 8G 及以上，建议设备 CPU i5-10500 及以上。 </li></ul> |

## 注意事项

- **单一通话页面**：当用户打开浏览器后，请只保留一个评审通话页面开启。多个通话页面使用同一个 UID 会导致会话互相踢出，从而引发通话异常。
- **设备音视频检测**：进入评标系统前，请先进行摄像头和麦克风设备测试，确保设备正常工作并已获得浏览器授权，避免评审过程中出现音视频问题。
- **定期清理缓存**：如遇到页面加载异常或功能无法正常使用的情况，建议清理浏览器缓存或使用浏览器的无痕/隐私模式重新访问系统。

## 接入流程

网易云信音视频通话 2.0 提供了全套 SDK，本文旨在帮助您实现 Web 端招采场景集成指导，供您在集成开发前参考。有关其他客户端的接入方式，请参考 [接入流程](https://doc.yunxin.163.com/nertc/concept/DkyMDM2Mzk?platform=client)。

```mermaid

  flowchart LR
    classDef default fill:#337EFF,stroke:#337EFF,stroke-width:0px,color:#FFFFFF;
    A("创建应用并获取 App Key") --> B(开通服务) --> C("集成 SDK") --> D(实现音视频通话基本功能) --> E("实现关键功能")
```

| <div style="width: 70px">步骤</div> | 操作指导 | 说明 |
| :--- | :--- | :--- |
| 1 | [创建应用并获取 App Key](/console/guide/TIzMDE4NTA) | 在 [网易云信控制台](https://app.yunxin.163.com/global/home) 中创建应用，查看该应用的应用密钥（App Key），后续集成 SDK 时，在本地工程中填入该 App Key。 |
| 2 | [开通 NERTC 服务](/console/concept/zc3NDYzNzc) | 在 [网易云信控制台](https://app.yunxin.163.com/global/home) 中为已创建的应用开通 **音视频通话** 服务。<br><img alt="image" src="https://yx-web-nosdn.netease.im/common/c3f6de8d2962fb2bab9d36f6c36f7a3f/image.png" style="width:40%;border: 1px solid #BFBFBF;"> |
| 3 | [集成 NERTC Web SDK](/nertc/guide/DM3MDA4NzQ) | 通过网易云信音视频通话 2.0 产品提供的 NERTC Web SDK，快速集成客户端 SDK。 |
| 4 | [实现音视频通话基本功能](/nertc/guide/TA1NTk0NzY) | 基于音视频通话 SDK 快速实现音视频通话的基本功能。以典型业务场景为例，为您介绍基于该业务流程的 SDK 实现步骤。 |
| 5 | 参考下文各项推荐配置，实现招采场景关键功能。 | 招采场景关键功能实现的推荐配置，如订阅配置，变声配置，录制配置等。 |

## 一：音视频参数配置

音视频参数配置（如分辨率、帧率、码率等）的设置目的在于提升用户体验、优化性能、确保安全性和满足业务场景的需求。

| <div style="width: 100px">属性</div> | 客户端 API | 推荐配置 | 推荐原因 |
| --- | --- | --- | --- |
| 音频属性 | [`setAudioProfile`](https://doc.yunxin.163.com/nertc/api-refer/web/typedoc/Latest/zh/html//interfaces/stream.stream-1.html#setaudioprofile) | speech_standard | 在网络环境不够稳定的情况下，低码率可以保证语音通话的基本需求。 |
| 视频属性 | [`setVideoConfig`](https://doc.yunxin.163.com/nertc/api-refer/web/typedoc/Latest/zh/html//interfaces/stream.stream-1.html#setvideoprofile) | 以整体画布比例为 16:9 为例：| 保证画面流畅性和画质清晰度。参考下文 [视频订阅配置推荐](#setSubscribeConfig)。 |\
| | | - **摄像头分辨率**：640 x 360 | |\
| | | - **摄像头帧率**：15 fps | |\
| | | - **屏幕共享分辨率**：1920 x 1080 | |\
| | | - **屏幕共享帧率**：15 fps | |
| 场景属性 | [`setChannelProfile`](https://doc.yunxin.163.com/nertc/api-refer/web/typedoc/Latest/zh/html//interfaces/client.client-1.html#setchannelprofile) | 会议场景：rtc（通信模式） | <ul><li>此模式对带宽要求低，延时较低。<li>在弱网环境下，优先保证低延时、高流畅的通话体验。 |

## 二：实现音频静音

评标通话过程中，涉及到用户静音的场景，有以下两种实现方式：

- **方式一**：[localStream.close](https://doc.yunxin.163.com/nertc/api-refer/web/typedoc/Latest/zh/html/interfaces/stream.stream-1.html#close)，关闭麦克风采集和音频流发布。

- **方式二**：（推荐）[localStream.muteAudio](https://doc.yunxin.163.com/nertc/api-refer/web/typedoc/Latest/zh/html/interfaces/stream.stream-1.html#muteaudio)，不关闭麦克风采集，只关闭音频流发布。

    :::note note
    如果不需要释放麦克风，仅仅是静音成员，推荐您采用 `muteAudio` 方式，这样能避免重复打开或关闭麦克风，从而避免浏览器与麦克风之间可能存在的连接不稳定性。
    :::

<a id="setSubscribeConfig"></a>

## 三：视频订阅配置推荐

评标通话过程中，专家之间一般不允许互相观看视频画面，且评标人不需要观看专家摄像头高清分辨率。您可根据网络状况或业务需求，按需订阅视频以及按需订阅大流或者小流，提升音视频通话质量。

::: note notice
业务层建议定义好不同角色的 `uid` 规则，便于订阅时进行判断。
:::

### 实现方法

1. 按需订阅视频流。您可以先判断 `uid` 角色，在设置订阅参数 [`Stream.setSubscribeConfig`](https://doc.yunxin.163.com/nertc/api-refer/web/typedoc/Latest/zh/html//interfaces/stream.stream-1.html#setsubscribeconfig) 时，设置 `video` 等参数为 `true` 或 `false` 来决定是否订阅，也就不需要再用视频遮罩等功能去处理，从而降低了观看端的带宽占用。

2. 按需订阅大流或者小流，详情请参考 [配置大小流](/nertc/guide/Dk1NTMyMzg?platform=web)。

### 配置推荐

1. 音视频发布订阅的推荐配置如下表所示：

    <table><thead>
    <tr>
        <th rowspan="2">人员</th>
        <th colspan="2">发布流</th>
        <th colspan="2">订阅流</th>
    </tr>
    <tr>
        <th>音频</th>
        <th>视频 &amp; 屏幕共享</th>
        <th>音频</th>
        <th>视频 &amp; 屏幕共享</th>
    </tr></thead>
    <tbody>
    <tr>
        <td>专家 1</td>
        <td>发布</td>
        <td>发布</td>
        <td>订阅所有人</td>
        <td>不订阅</td>
    </tr>
    <tr>
        <td>专家 2</td>
        <td>发布</td>
        <td>发布</td>
        <td>订阅所有人</td>
        <td>不订阅</td>
    </tr>
    <tr>
        <td>专家 3</td>
        <td>发布</td>
        <td>发布</td>
        <td>订阅所有人</td>
        <td>不订阅</td>
    </tr>
    <tr>
        <td>......</td>
        <td>......</td>
        <td>......</td>
        <td>......</td>
        <td>......</td>
    </tr>
    <tr>
        <td>评标人</td>
        <td>发布</td>
        <td>不发布</td>
        <td>订阅所有人</td>
        <td>订阅所有人</td>
    </tr>
    <tr>
        <td>监督人</td>
        <td>不发布</td>
        <td>不发布</td>
        <td>订阅所有人</td>
        <td>订阅所有人</td>
    </tr>
    </tbody>
    </table>

2. 评标人与监督人的画面布局，如果专家比较多，建议分页展示，避免占用过多设备内存，导致画面卡顿等问题。一个分页可以展示两个专家的画面，如下示例：

    <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/7552ff9ec9bf8ced8b3d09811d16ba8e/image.png" style="width:50%;border: 1px solid #BFBFBF;">

## 四：变声实现推荐

从 [NERTC Web SDK 5.5.11](https://doc.yunxin.163.com/nertc/concept/zU5NzI3NTM?platform=client#5511-2023-11-30) 版本开始，基于 AI 音效插件实现了 [美声变声](https://doc.yunxin.163.com/nertc/guide/DU1MTA3ODM?platform=web) 能力。支持多种预设音效包括音调调整、美声效果和混响处理。针对招采场景，您可以选用 5.8.0 及以上版本 NERTC Web SDK。

::: note notice
- AI 音效插件与伴音功能互斥，不可同时使用。

- AI 音效插件既支持本地音频流调整，也支持远端流处理。
:::

**实现方法** 如下：

1. 创建本地视频流并发布，参考 [实现音视频通话](/nertc/guide/TA1NTk0NzY?platform=web)。

2. 调用 [`setAudioEffect`](https://doc.yunxin.163.com/nertc/references/web/typedoc/Latest/zh/html/interfaces/stream.stream-1.html#setaudioeffect) 和 [`disableAudioEffect`](https://doc.yunxin.163.com/nertc/references/web/typedoc/Latest/zh/html/interfaces/stream.stream-1.html#disableaudioeffect) 接口使用变声功能。推荐使用 **成熟** 音效（`client.setAudioEffect(0, 4);`），详情请参考 [AI 音效](https://doc.yunxin.163.com/nertc/guide/DU1MTA3ODM?platform=web#%E5%9C%BA%E6%99%AF%E4%B8%80%E6%9C%AC%E7%AB%AF%E6%B5%81%E9%99%8D%E5%99%AA-%E8%BF%9C%E7%AB%AF%E6%B5%81%E6%B7%B7%E6%B5%81%E5%90%8E%E5%8F%98%E5%A3%B0)《场景一：本端流降噪 + 远端流混流后变声》查看相关示例代码。

<!--     ```JavaScript
    //开启变声
    const value = 0.5 //取值范围 [-1,1]，step = 0.1，值为 0 时为原声
    localStream.setAudioEffectLite('Pitch', value)

    //关闭变声
    localStream.disableAudioEffectLite() 关闭音效
    ``` -->

<a id="recordConfig"></a>

## 五：录制实现推荐

网易云信云端录制功能在原有单人模式、混流模式基础上，扩展支持更加灵活的音视频录制组合模式。

### 文件生成规则

在 [创建云端录制任务](https://doc.yunxin.163.com/docs/jcyOTA0ODM/TEyOTk2OTY) 服务端接口中，对于 [`recordConfig`](https://doc.yunxin.163.com/nertc/server-apis/jc2MjQzMzA?platform=server#recordconfig) 的单人视频与混合音频录制模式中（即 `mode` 100 招采模式），为避免重复音频数据录制，遵循以下文件生成规则：

- **音视频房间**：视频用户分别生成单人文件，纯音频、或只订阅音频用户不单独生成文件。

- **纯音频房间**：假设频道无人开视频、全部纯音频，录制结果只生成一个 `mix` 的 `.aac` 文件，对应的用户 ID（`uid`）固定为 `1000006`，对应录制单独音频文件录制模式（即 `mode` 6 单独音频文件模式）。

### 指定录制用户

1. 您可以将业务维护专家 `uid` 名单：

    - 通过 [订阅名单](https://doc.yunxin.163.com/nertc/server-apis/DYwODU5NTQ?platform=server) 形式在 [创建云端录制任务](https://doc.yunxin.163.com/docs/jcyOTA0ODM/TEyOTk2OTY) 传入。
    - 或在评标过程中，调用 [更新订阅名单](https://doc.yunxin.163.com/docs/jcyOTA0ODM/DYwODU5NTQ) 接口更新。

2. 招采场景一般需要录制专家视频，以及所有参会人（包括评标人）音频，您可以设置 `videoUidList` 订阅专家视频，设置 `audioUidList` 订阅全部参会人。

### 录制人数限制

- 频道单人录制、`mode` 100 招采模式，均不限制录制人数。
- 合流自定义布局视频人数限制，已开放至最高 64 人。

### 解决视频黑边

为保证视频画面不变形，录制分辨率需保持宽高比例一致。在录制分辨率层面，网易云信的缩放模式，支持 **适应图片** 和 **适应区域** 两种。

在 **适应图片** 模式下，可能出现背景色黑边。解决方式如下：

1. 在可接受部分内容被裁减的前提下，调整 `adaption` 为 **适应区域**（取值为 `1`），保证区域被填满。详情请参考 [录制布局](https://doc.yunxin.163.com/nertc/server-apis/TA0MjE1MzE?platform=server#%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%94%BB%E9%9D%A2) 设置用户画面章节 `adaption` 参数说明。

2. 选择自定义布局，调整用户区域和用户视频画面比例一致。

<!-- 这里真的是并列方式吗 -->

### 效果示例

不同录制模式的主要区别是模式设置参数（`mode`）的取值不同。在 [创建云端录制任务](https://doc.yunxin.163.com/docs/jcyOTA0ODM/TEyOTk2OTY) 服务端接口中，模板文件集合模式列表（[`modeList`](https://doc.yunxin.163.com/nertc/server-apis/jc2MjQzMzA?platform=server#recordconfig)）可以传多个 `mode`，但每个 `mode` 值只能设置一次，您可以按需组合 `modeList` 来达到最终录制需求。

:::::: div custom-tabs
::: tab 专家模式 [默认布局]

该模式将每个专家的摄像头和屏幕共享录制在同一个文件中，并且录制所有人音频。模式设置参数为 `"mode": 100`。

<div style="display: flex; justify-content: space-between; width: 100%;">
    <div style="width: 50%;text-align: center; caption-side: top;"">
        <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>摄像头</b></figcaption>
        <img alt="" src="https://yx-web-nosdn.netease.im/common/3090649359d61a6ccad021564b168e3f/image.png" style="width:90%;border: 1px solid #BFBFBF;"></figure>
    </div>
    <div style="width: 50%;text-align: center; caption-side: top;"">
            <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>屏幕共享</b></figcaption>
      <img alt="" src="https://yx-web-nosdn.netease.im/common/ce4b7093cedca482c1a055be615ddebe/image.png" style="width:90%;border: 1px solid #BFBFBF;"></figure>
    </div>
    <div style="width: 50%;text-align: center; caption-side: top;"">
        <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>摄像头+屏幕共享</b></figcaption>
        <img alt="" src="https://yx-web-nosdn.netease.im/common/68db919e02f77017c9b71f75978027dd/image.png" style="width:90%;border: 1px solid #BFBFBF;"></figure>
    </div>
</div>

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 100,
        "modeList": [
            {
                "mode": 100
            }
        ]
    },
    "streamSubscribe": {
        "streamType": 2,
        "audioUidList": {
            "unSubscribeUids": [
            ]
        },
        "videoUidList": {
            "subscribeUids": [
                66601,
                66602
            ]
        }
    }
}
```

:::
::: tab 专家模式 [摄像头和屏幕共享分别录制]

该模式将每个专家的摄像头和屏幕共享分别录制在两个文件中，并且只录制专家自己的音频。模式设置参数为 `"mode": 0`。

<div style="display: flex; justify-content: space-between; width: 100%;">
    <div style="width: 50%;text-align: center; caption-side: top;"">
        <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>摄像头</b></figcaption>
        <img alt="" src="https://yx-web-nosdn.netease.im/common/3090649359d61a6ccad021564b168e3f/image.png" style="width:70%;border: 1px solid #BFBFBF;"></figure>
    </div>
    <div style="width: 50%;text-align: center; caption-side: top;"">
            <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>屏幕共享</b></figcaption>
      <img alt="" src="https://yx-web-nosdn.netease.im/common/ce4b7093cedca482c1a055be615ddebe/image.png" style="width:70%;border: 1px solid #BFBFBF;"></figure>
    </div>
</div>

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 0,
        "modeList": [
            {
                "mode": 0
            }
        ]
    }
}
```
:::
::: tab 专家模式 [自定义布局]

该模式将每个专家的摄像头和屏幕共享录制在同一个文件中，并且录制所有人音频。模式设置参数为 `"mode": 100`。

| 单流全屏配置 | 摄像头 | 屏幕共享 | 摄像头+屏幕共享 |
| --- | --- | --- | --- |
| 未配置（默认） | <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/00568e48d20f5ea94d2e3a1bb8acbdad/image.png" style="width:80%;border: 1px solid #BFBFBF;"> | <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/13a398df8ed0a55fb06b828f79fd984c/image.png" style="width:80%;border: 1px solid #BFBFBF;"> | <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/a7ec3a34bc57758c84dc4c5564843999/image.png" style="width:80%;border: 1px solid #BFBFBF;"> |
| 配置 <note type="note">如需开通单流全屏配置，请 [提交工单](https://app.yunxin.163.com/global/service/ticket/create) 联系网易云信技术支持工程师。</note> | <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/3090649359d61a6ccad021564b168e3f/image.png" style="width:80%;border: 1px solid #BFBFBF;"> | <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/ce4b7093cedca482c1a055be615ddebe/image.png" style="width:80%;border: 1px solid #BFBFBF;"> | <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/a7ec3a34bc57758c84dc4c5564843999/image.png" style="width:80%;border: 1px solid #BFBFBF;"> |

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 100,
        "modeList": [
            {
                "mode": 100,
                "layoutType": 2,
                "layout": {
                    "canvas": {
                        "width": 720,
                        "height": 480
                    },
                    "subStreams": [
                        {
                            "adaption": 0,
                            "x": 0,
                            "width": 720,
                            "y": 0,
                            "zOrder": 1,
                            "height": 384
                        }
                    ],
                    "users": [
                        {
                            "adaption": 1,
                            "x": 270,
                            "width": 144,
                            "zOrder": 2,
                            "y": 384,
                            "height": 96
                        }
                    ]
                }
            }
        ]
    },
    "streamSubscribe": {
        "streamType": 2,
        "audioUidList": {
            "unSubscribeUids": [
            ]
        },
        "videoUidList": {
            "subscribeUids": [
                66601,
                66602
            ]
        }
    }
}
```

:::
::: tab 合流模式

该模式将所有专家的摄像头和屏幕共享混合录制在一个文件中，并且录制所有人音频。模式设置参数为 `"mode": 1`。

<img alt="image.png" src="https://yx-web-nosdn.netease.im/common/7552ff9ec9bf8ced8b3d09811d16ba8e/image.png" style="width:50%;border: 1px solid #BFBFBF;">

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 100,
        "modeList": [
            {
                "mode": 1,
                "layoutType": 2,
                "layout": {
                    "canvas": {
                        "width": 1280,
                        "height": 720
                    },
                    "users": [
                        {
                            "uid": 66601,
                            "x": 0,
                            "y": 0,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        },
                        {
                            "uid": 66602,
                            "x": 640,
                            "y": 0,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        }
                    ],
                    "subStreams": [
                        {
                            "uid": 66601,
                            "x": 0,
                            "y": 360,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        },
                        {
                            "uid": 66602,
                            "x": 640,
                            "y": 360,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        }
                    ]
                }
            }
        ]
    },
    "streamSubscribe": {
        "streamType": 2,
        "audioUidList": {
            "unSubscribeUids": [

            ]
        },
        "videoUidList": {
            "subscribeUids": [
                66601,
                66602
            ]
        }
    }
}
```
:::
::: tab 合流模式 [仅摄像头]

该模式是将所有专家的摄像头录制在一个文件中，不包含专家的屏幕共享，并且录制所有人音频，该模式采用画廊视图。模式设置参数为 `"mode": 4`。

<div style="display: flex; justify-content: space-between; width: 100%;">
    <div style="width: 50%;text-align: center; caption-side: top;"">
        <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>1～2人</b></figcaption>
        <img alt="" src="https://yx-web-nosdn.netease.im/common/6f7ab4ec6b6383cd7b58db561061f4e3/image.png" style="width:80%;border: 1px solid #BFBFBF;"></figure>
    </div>
    <div style="width: 50%;text-align: center; caption-side: top;"">
            <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>3～4人</b></figcaption>
      <img alt="" src="https://yx-web-nosdn.netease.im/common/ece3e3f9ae914137f8ce57458f134cc6/image.png" style="width:80%;border: 1px solid #BFBFBF;"></figure>
    </div>
    <div style="width: 50%;text-align: center; caption-side: top;"">
        <figure>
      <figcaption style="width: 100%; text-align: center; caption-side: top;"><b>5 人以上</b></figcaption>
        <img alt="" src="https://yx-web-nosdn.netease.im/common/2e687c5cc65bd835d4f54c862152e658/image.png" style="width:80%;border: 1px solid #BFBFBF;"></figure>
    </div>
</div>

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 100,
        "modeList": [
            {
                "mode": 4
            }
        ]
    }
}
```
:::
::::::

基于以上常规的录制模式设置，通过按需组合 `modeList` 来达到最终录制需求的示例如下：

:::::: div custom-tabs
::: tab 专家合流模式一

**专家合流模式一** 会根据您选择的专家模式（默认的或者自定义的）以及合流模式进行输出，每个专家会生成一个包含了该专家摄像头、屏幕共享以及混合所有人声音的录制文件，还会再生成一个所有人的音视频混合在一起的录制文件。

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 100,
        "modeList": [
            {
                "mode": 100
            },
            {
                "mode": 1,
                "layoutType": 2,
                "layout": {
                    "canvas": {
                        "width": 1280,
                        "height": 720
                    },
                    "users": [
                        {
                            "uid": 66601,
                            "x": 0,
                            "y": 0,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        }
                    ],
                    "subStreams": [
                        {
                            "uid": 66601,
                            "x": 0,
                            "y": 360,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        }
                    ]
                }
            }
        ]
    },
    "streamSubscribe": {
        "streamType": 2,
        "audioUidList": {
            "unSubscribeUids": [
            ]
        },
        "videoUidList": {
            "subscribeUids": [
                66601,
                66602
            ]
        }
    }
}
```
:::
::: tab 专家合流模式二

**专家合流模式二** 会在 **专家合流模式一** 基础上，每个专家再多生成一个摄像头录制视频文件和一个屏幕共享录制视频文件，这两个文件只有专家自己的声音，不会混合所有人的声音。配置文件会比 **专家合流模式一** 多一个 `"mode": 0` 设置。

<note type="note">如需使用 **专家合流模式二**，请 [提交工单](https://app.yunxin.163.com/global/service/ticket/create) 联系网易云信技术支持工程师。
</note>

**配置示例**：

```JSON
{
    "cid": 114433117788,
    "recordConfig": {
        "recordType": 100,
        "modeList": [
            {
                "mode": 100
            },
            {
                "mode": 0
            },
            {
                "mode": 1,
                "layoutType": 2,
                "layout": {
                    "canvas": {
                        "width": 1280,
                        "height": 720
                    },
                    "users": [
                        {
                            "uid": 66601,
                            "x": 0,
                            "y": 0,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        }
                    ],
                    "subStreams": [
                        {
                            "uid": 66601,
                            "x": 0,
                            "y": 360,
                            "width": 640,
                            "height": 360,
                            "adaption": 0
                        }
                    ]
                }
            }
        ]
    },
    "streamSubscribe": {
        "streamType": 2,
        "audioUidList": {
            "unSubscribeUids": [
            ]
        },
        "videoUidList": {
            "subscribeUids": [
                66601,
                66602
            ]
        }
    }
}
```
:::
::::::

<a id="queryMediaFile"></a>

## 六：获取录制文件

通过上文 [录制实现推荐](#recordConfig) 提到的录制实现配置录制任务，通话结束之后，服务器侧会开始转码并生成对应的录制文件。网易云信提供了抄送回执和接口 API 的两种形式，可以用于获取生成的录制文件。

::: note notice
招采场景，一般通话时间较长，生成的录制文件较大，生成录制文件对应需要的转码时间也会较长。所以，通话结束后，您需要等待一段时间才能收到录制文件。如果您有更快速的录制时间诉求，可以 [提交工单](https://app.yunxin.163.com/global/service/ticket/create) 联系网易云信技术支持工程师开通高优先级录制功能。
:::

**实现方法** 如下：

- **方式一**：（推荐）通话结束之后，录制文件通过抄送的形式，将生成的录制文件下载链接（URL）抄送到您在 [网易云信控制台](https://app.yunxin.163.com/global/home) 配置的抄送地址。

    消息抄送是网易云信提供的消息同步服务，通过这一服务，可以将录制文件的详细内容，以 HTTP/HTTPS 请求的形式实时同步给您预设的服务器地址。相关字段信息请参考 [房间管理事件抄送](https://doc.yunxin.163.com/nertc/server-apis/DUyOTg1NDI?platform=server#3-%E5%BD%95%E5%88%B6%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BF%A1%E6%81%AF) 录制文件下载信息章节。

- **方式二**：您可以调用 SDK 的 [queryMediaFileByChannelId.action](https://doc.yunxin.163.com/nertc/server-apis/jYwNzI3MDk?platform=server) 接口，主动通过音视频的房间 ID（`cid`）查询。详情请参考 [获取录制文件](https://doc.yunxin.163.com/nertc/server-apis/jYwNzI3MDk?platform=server)。

网易云信的录制文件按照特定的命名方式命名，命名格式如下所示：

- **音视频单人录制文件**：`uid-cid-timestamp-sliceindex.filetype`

- **音视频混合录制文件**：`0-cid-timestamp-sliceindex-mix.filetype`

- **互动直播录制文件**：`taskId-cid-timestamp-sliceindex.filetype`

录制文件名称不支持提前配置。如需修改命名，您可以在收到录制文件后，调用 [修改视频文件信息 `/app/vod/video/edit`](https://doc.yunxin.163.com/vod/server-apis/jI0Njk0NzU?platform=server#%E4%BF%AE%E6%94%B9%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF) 接口修改文件信息。

## 七：解决网络受限问题

招采场景可能存在服务器部署在受限环境中，如仅允许内网访问评标系统，仅允许加白 IP 地址访问评标系统。

针对上述网络受限的场景，您可以考虑如下解决方案：

- **IP 白名单**：当评标系统用户集中在某个单一地区时，推荐使用该方式。实现原理是网易云信对 **指定应用** 限制使用某地区的服务器提供服务，在合作过程中网易云信提供对应的服务器 IP 列表，您再将对应 IP 列表添加到内部防火墙，以应对部分网络受限场景。

    如需使用该方式，请联系网易云信商务或 [提交工单](https://app.yunxin.163.com/global/service/ticket/create) 联系网易云信技术支持工程师。

- **云代理方式**：当评标系统用户分散在全国各地时，推荐使用该方式。实现原理请参考 [实现云代理](https://doc.yunxin.163.com/nertc/guide/Tg4NzAzNDY?platform=web)。

- **私有化部署**：当部分客户面临强烈的监管及数据不外流的需求时，可以考虑该方式。通过将网易云信服务完全本地部署的方式提供服务，需要业务客户提供具体的服务器资源。如需使用该场景，请联系网易云信商务或 [提交工单](https://app.yunxin.163.com/global/service/ticket/create) 联系网易云信技术支持工程师。

    ::: note notice
    私有化场景没有单独查询录制文件的管理后台，在 [获取录制文件](#queryMediaFile) 时，建议您依赖抄送方式获取录制文件地址。如果您需要查看私有化服务器上对应的存储文件，请联系私有化实施工程师了解存储路径。
    :::

## 八：通话音视频数据流加密

招采场景涉及通话内容敏感时，为了防止被黑客等获取到明文的音视频数据流，避免信息泄露，您可以考虑如下解决方案：

- **方式一**：（建议）使用国密算法加密实现。NERTC SDK 已内置国密算法加密模式，您自行管理好密钥即可。

- **方式二**：使用自定义加密算法实现。此方式需要您完整实现加解密过程，比较复杂。

    以上两种加密算法请参考 [媒体流加密](https://doc.yunxin.163.com/nertc/guide/TE4MjYwMTU?platform=web)。请详细阅读媒体流加密文档的注意事项等，如有遗漏，可能会导致加解密失败，进而导致听不见、看不到等现象。

## 九：设置屏幕共享

招采场景涉及到安全合规时，存在需要屏幕共享开启时，只允许共享整个屏幕，不能选择窗口和浏览器标签页的场景。针对此场景，您可以考虑做如下方案设置：

1. 用户加入房间前，修改 `NERTC.getParameters().forceDisplaySurface` 为 `monitor`，以选择屏幕共享区域。`forceDisplaySurface` 的可选值包括了 `default`、`browser`、`window`、`monitor`，默认为 `default`，`monitor` 代表只允许共享整个屏幕。

2. 设置为 `monitor` 后，如果用户选择了其他区域进行共享，会触发回调方法 `Client.on("displaySurfaceError",...)`，您可以提示让用户重新开启屏幕共享，必须选择 **整个屏幕**。

    <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/ab743f59c64cb57fa945ed8ace0dfd22/image.png" style="width:40%;border: 1px solid #BFBFBF;">

## 十：转存点播文件

<!-- 公有云点播转存私有化 -->

在实现网易云信点播服务私有化后，如果您需要通过私有化环境访问之前公有云的点播文件，您可以按以下步骤将公有云环境点播文件转存到私有化服务器上。

1. 获取点播文件列表。

    <!-- 如果您公有云已经自行做了点播文件存储地址，那么这一步可以忽略。-->

    - **方式一**：直接调用点播服务端接口。您可以自行调用 [`vcloud.163.com/app/vod/video/list`](https://doc.yunxin.163.com/vod/server-apis/jI0Njk0NzU?platform=server#%E6%9F%A5%E8%AF%A2%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%E5%88%97%E8%A1%A8) 接口分页获取。
    - **方式二**：通过脚本调用点播服务端接口。

        1. 下载 [`getVideoList.py`](https://yx-web-nosdn.netease.im/common/c4c1c08d9bd6634893947e137a626ed0/getVideoList.py) Python 脚本。该脚本通过自动执行 `vod/video/list` 服务端接口实现获取。
        2. 自行修改脚本中的参数：
            - **`appkey` 和 `appsecret`**：用于识别开发者身份，获取方式请参考 [创建应用并获取 AppKey](https://doc.yunxin.163.com/console/concept/TIzMDE4NTA?platform=console)。
            - **`start_date` 和 `end_date`**：用于修改获取点播文件的时间范围。
        3. 在 Python 环境下，执行 `python getVideoList.py` 命令运行脚本。
        4. 在脚本所在路径下，打开并查看自动生成的 `video_list.csv` 文件，文件中包含了原始下载文件，转码下载文件等。

            <img alt="image.png" src="https://yx-web-nosdn.netease.im/common/0813ae25054bf8c72de89fe840b2e0d1/image.png" style="width:80%;border: 1px solid #BFBFBF;">

2. 根据您获取到的点播文件列表，按照存储地址下载文件。

    :::note note
    - 下载方式不限，您可以自行调用迅雷或者系统的下载指令下载。
    - 下载点播文件会涉及公有云点播下行带宽流量计费。请核实您的公有云点播计费规则。如果是按照日峰值带宽计费的话，请注意并行下载数量，避免同时下载的带宽过高造成较高的点播计费。
    - 下载点播文件会占用您本地业务服务器带宽，建议您在业务低峰期下载，避免造成其他影响。
    :::

3. 按需上传点播文件到私有化环境。不同私有化环境的上传方式可能不一样，您可以和网易云信实施工程师联系。

## 总结

本实践文档详细介绍了通过网易云信实现 Web 版本招采评标系统的音视频参数配置、音频静音实现、视频订阅、变声功能、录制推荐方法、文件生成规则、网络受限问题的解决方案以及屏幕共享设置，旨在优化评标流程，提升效率和安全性。通过这些功能，系统能够满足不同评标场景中评标专家、评标人、监督人的功能使用需求，同时通过安全保障和审计资料确保评标过程的公正性和透明度。如果您对招采场景方案有其他功能需求，或对文中描述有任何疑问，请 [提交工单](https://app.yunxin.163.com/global/service/ticket/create) 联系网易云信技术支持工程师。