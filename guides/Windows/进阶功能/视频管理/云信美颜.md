
<!--- keywords： 美颜，滤镜，美白，磨皮，瘦脸 -->

NERTC SDK 提供云信自研的基础美颜和高级美颜功能，帮助用户在音视频通话或互动直播场景中，对人脸进行美肤、美型等美颜调整，或通过画面滤镜改变视频的色调与氛围。

::: note note
**自 V4.6.20 起**，云信美颜功能支持**插件化**集成，请在集成时引入美颜库 `NERtcBeauty.dll` 和 `NERtcFaceDetect.dll`，具体集成方式请参考<a href="/docs/zUyNzE0ODI/jM4NzgxMzg" target="_blank">集成 SDK</a>。
:::

## 前提条件

- 请在<a href="https://yunxin.163.com/" target="_blank">官网首页</a>通过在线消息、微信或电话联系云信商务经理，获取对应的美颜资源或模型。
- 基础美颜可以免费使用。高级美颜需要开通授权才能正式使用，未开通的高级美颜时，只能在调用高级美颜时体验2分钟高级美颜效果。请在云信控制台开通高级美颜，具体请参见[开通高级美颜](#开通高级美颜)。
- 已集成 NERTC SDK，并实现了基础音视频通话或互动直播流程。

## 注意事项

调用 <a href="https://doc.yunxin.163.com/nertc/api-refer/windows/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine.html#ad958fcb663c93a8c84d516effc50e863" target="_blank">`enableLocalVideo`</a> 开启本地视频采集时，请设置 `NERtcVideoStreamType` 为 `kNERTCVideoStreamMain`，否则美颜效果不会生效。

## 基础美颜
云信基础美颜可免费使用。

云信基础美颜支持美白、磨皮、红润和锐化 4 种效果，程度可调节，具体参数如下表所示。

| 分类 | 项       | 枚举值                  | 描述                                       |
|------|----------|-------------------------|--------------------------------------------|
| 美肤 | 美白     | kNERtcBeautyWhiten      | 强度范围 0~1，默认值为 0，推荐值为 0.80    |
| ^^   | 磨皮     | kNERtcBeautySmooth      | 强度范围 0~1，默认值为 0，推荐值为 0.65    |
|  ^^  | 红润     | kNERtcBeautyFaceRuddy   | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
|  ^^  | 锐化     | kNERtcBeautyFaceSharpen | 强度范围 0~1，默认值为 0，推荐值为 0.10    |

基础美颜的实现方法和高级美颜一样，具体步骤请参见[高级美颜中的实现方法](#实现方法)。

## 高级美颜

云信高级美颜支持美白、磨皮、瘦脸、大眼等多种美肤、美型效果。
### 开通高级美颜

1. 登录<a href="https://app.yunxin.163.com/index#/" target="_blank">网易云信控制台</a>。

2. 在首页单击指定应用名称。
3. 在**产品总览**区域，单击**音视频通话 2.0** 产品选项卡中的**功能配置**。


    ![功能配置.png](https://yx-web-nosdn.netease.im/common/50fdee5139f9e30204445b9386f205cd/功能配置.png)



4. 单击**高级功能**页签，单击 **高级美颜** 的开关按钮，开启高级美颜。


    
    ![开通高级美颜.png](https://yx-web-nosdn.netease.im/common/efb0692b9fdc5c21076b4b4dffa63ce7/开通高级美颜.png)



5. 单击**确定**。

### <span id="实现方法">实现方法</span> 

NERTC SDK 基础美颜、高级美颜的实现方法如下：
1. 向商务经理获取最新版本的美颜资源和模型，或从[美颜 Demo](https://github.com/netease-im/Advanced-Video/tree/master/NEBeauty/PC/personcall-1v1_nertc_beauty/data/beauty/nebeauty) 中获取美颜资源和模型。
2. 启用美颜模块。

    在开启视频之前，调用 [`startBeauty`](https://doc.yunxin.163.com/nertc/api-refer/windows/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#a4801d58157f60f6ca568b544b17e9cf9) 开启美颜功能模块。
    在 `file_path` 中设置美颜资源的绝对路径。例如：`e:\data\beauty\nebeauty\beauty`。

3. （可选）暂停和恢复美颜功能。

    启用美颜功能后，您可以调用 [`enableBeauty`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a65d1eaace634e586df917fc94d422192)暂停或恢复美颜功能，参数说明如下：
    - false: 暂停美颜。暂停后，所有美颜和滤镜效果都会暂时取消，直至重新启用美颜效果。
    - true: 恢复美颜。
4. 调整美颜效果。

    - 调用 [`setBeautyEffect`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#af64ab24cfee39626008321cfc8b2981d) 手动设置各种美颜效果，并调整对应的效果强度，具体参数请参见[高级美颜枚举值](#高级美颜枚举值)。
    
    <div style="width:60px">参数</div> | <div style="width:100px">说明</div>  |
    ---- | -------------- 
    `type` | 用于指定美颜效果。目前支持美白、磨皮等美颜效果。 | 
    `level` |用于指定美颜强度。取值范围为 [0,1]，各种美颜效果的默认值不同。取值越大，美颜强度越大，请根据业务需要自定义设置美颜强度。 |

    - 调用 [`enableBeautyMirrorMode`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a811511555c432341acd4f46995fe588c) 可以在启用美颜时开启或关闭镜像模式。


    ::: note note
    美白、磨皮等美颜效果可以互相叠加，也可以和滤镜效果互相叠加，但是不能同时使用多款滤镜。
    :::

5. 结束美颜模块。

    无需使用美颜效果时，需要调用 [`stopBeauty`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a0e57b19e0d7c4a4822f359e9638fa6f0) 结束美颜功能模块，此时 SDK 会自动销毁美颜引擎并释放资源。

### <span id="高级美颜枚举值">高级美颜枚举值</span>
高级美颜目前有 28 种效果，程度可调节，且包含了基础美颜的 4 种效果。


| <div style="width:60x">分类</div> | <div style="width:60px">项</div>  | 枚举值                  | <div style="width:80px">描述</div> |
|------|----------|-------------------------|--------------------------------------------|
| 美肤 | 美白     | kNERtcBeautyWhiten      | 强度范围 0~1，默认值为 0，推荐值为 0.80    |
| ^^   | 磨皮     | kNERtcBeautySmooth      | 强度范围 0~1，默认值为 0，推荐值为 0.65    |
|  ^^  | 红润     | kNERtcBeautyFaceRuddy   | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
|  ^^  | 锐化     | kNERtcBeautyFaceSharpen | 强度范围 0~1，默认值为 0，推荐值为 0.10    |
| 脸型 | 瘦脸     | kNERtcBeautyThinFace    | 强度范围 0~1，默认值为 0，推荐值为 0.35    |
| ^^   | V 脸     | kNERtcBeautyVFace       | 强度范围 0~1，默认值为 0，推荐值为 0.00    |
|  ^^  | 窄脸     | kNERtcBeautyNarrowFace  | 强度范围 0~1，默认值为 0，推荐值为 0.00    |
|  ^^  | 小脸     | kNERtcBeautySmallFace   | 强度范围 0~1，默认值为 0，推荐值为 0.10    |
| 面部 | 瘦颧骨   | kNERtcBeautyCheekBone   | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
|  ^^  | 瘦下颌   | kNERtcBeautyUnderJaw    | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
|  ^^  | 瘦下巴   | kNERtcBeautyJaw         | 强度范围 0~1，默认值为 0，推荐值为 0.40    |
|  ^^  | 人中调整 | kNERtcBeautyPhiltrum    | 强度范围 0~1，默认值为 0.50，推荐值为 0.50 |
| ^^   | 袪抬头纹  | kNERtcBeautyForeheadWrinkles| 强度范围 0~1，默认值为 0，推荐值为 0.30    |
| ^^   |  袪法令纹  | kNERtcBeautySmileLines  | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
| ^^   |短脸       | kNERtcBeautyShortFace  | 强度范围 0~1，默认值为 0，推荐值为  0.10 |
| 眼睛 | 大眼     | kNERtcBeautyBigEye      | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
| ^^   | 圆眼     | kNERtcBeautyRoundEye    | 强度范围 0~1，默认值为 0，推荐值为 0.80    |
| ^^   | 亮眼     | kNERtcBeautyLightEye    | 强度范围 0~1，默认值为 0，推荐值为 0.60    |
| ^^   | 开眼角   | kNERtcBeautyEyeCorner   | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
| ^^   | 眼距调整 | kNERtcBeautyEyeDis      | 强度范围 0~1，默认值为 0.50，推荐值为 0.50 |
| ^^   | 眼角调整 | kNERtcBeautyEyeAngle    | 强度范围 0~1，默认值为 0.50，推荐值为 0.50 |
| ^^   |袪黑眼圈  | kNERtcBeautyDarkCircles  |强度范围 0~1，默认值为 0，推荐值为 0.30    |
| 鼻子 | 小鼻     | kNERtcBeautySmallNose   | 强度范围 0~1，默认值为 0，推荐值为 0.40    |
| ^^  | 鼻长调整 | kNERtcBeautyLongNose    | 强度范围 0~1，默认值为 0.50，推荐值为 0.50 |
| 嘴巴 | 美牙     | kNERtcBeautyWhiteTeeth  | 强度范围 0~1，默认值为 0，推荐值为 0.30    |
| ^^   | 嘴角调整 | kNERtcBeautyMouthAngle  | 强度范围 0~1，默认值为 0.50，推荐值为 0.50 |
|  ^^  | 嘴型调整 | kNERtcBeautyMouth       | 强度范围 0~1，默认值为 0.50，推荐值为 0.50 |
| ^^  | 嘴巴宽度 |kNERtcBeautyMouthWider |强度范围 0~1，默认值为 0.50，推荐值为 0.50（不调整宽度） |




## <span id="滤镜">滤镜</span>
云信美颜支持通过美颜资源或模型打造多种个性化的滤镜。

1. 请向云信商务经理获取最新版本的滤镜资源，或从[美颜 Demo](https://github.com/netease-im/Advanced-Video/tree/master/NEBeauty/PC/personcall-1v1_nertc_beauty/data/beauty/nebeauty) 中获取滤镜资源。
2. 启用美颜模块。

    在开启视频之前，调用 [`startBeauty`](https://doc.yunxin.163.com/nertc/api-refer/windows/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#a4801d58157f60f6ca568b544b17e9cf9) 开启美颜功能模块。开启美颜功能之后才能使用美颜、滤镜等美颜效果。
3. 调用 [`addBeautyFilter`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a8194bd969d518e5b9f7fa0e180f7ec3c) 添加滤镜效果。
    
    ::: note note
    滤镜效果可以和美颜等效果互相叠加，但是不支持叠加多个滤镜。
    
    需要更换滤镜时，重复调用此接口使用新的滤镜资源即可。
    :::
    
    <div style="width:60px">参数</div> | <div style="width:100px">说明</div>  |
    ---- | -------------- 
    `file_path` | 指定滤镜模型所在路径。例如 `e:\Resources\Filters\filters.bundle\filter_style_白皙\template.json`。 | 
    `level`|指定滤镜强度。取值范围为 [0,1]，默认为 0.5。取值越大，滤镜越明显，请根据业务需要自定义设置滤镜强度 |

4. 您可以通过[`setBeautyFilterLevel`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a27ebf197ab1870222e89b809cc583b8c) 设置滤镜强度。
5. 不需要使用滤镜效果时，调用 [`removeBeautyFilter`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#aab398bfe035478175387f8cb8355f9d1) 移除滤镜。
6. 结束美颜模块。

    无需使用美颜效果时，需要调用 [`stopBeauty`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a0e57b19e0d7c4a4822f359e9638fa6f0) 结束美颜功能模块，此时 SDK 会自动销毁美颜引擎并释放资源。

<!--
### 美妆

1. 调用 [`addBeautyMakeup`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#a29524e65c63146907e9762254aea0f46) 添加美妆效果。

    美妆效果可以和美颜、滤镜、贴纸等效果互相叠加，但是不支持叠加多个美妆效果。需要更换美妆效果时，重复调用此接口使用新的美妆模型即可。

    添加美妆效果时，需要通过 `file_path` 指定美妆模型所在路径，例如 `e:\Resources\StickerZipAndIcons\makeup_sticker.bundle\makeup\template.json`。
2. 不需要使用美妆效果时，调用 [`removeBeautyMakeup`](/docs/interface/NERTC_SDK/Latest/PC/html/classnertc_1_1_i_rtc_engine_ex.html#abb5708124e7324e91692a77898eb2ebb) 移除美妆效果。

-->
## 示例代码
云信美颜 Demo 的示例项目源码请参见[美颜的示例项目](https://github.com/netease-im/Advanced-Video/tree/master/NEBeauty)。


```c++
//启用美颜模块
//path:美颜路径
rtc_engine_->startBeauty(path);

//开启美颜功能
rtc_engine_->enableBeauty(true);

//调整美颜效果
//type:美颜类型
//level:美颜强度
rtc_engine_->setBeautyEffect((nertc::NERtcBeautyEffectType)type, level);

//滤镜
//filter_file_path 是滤镜效果文件的路径
rtc_engine_->addBeautyFilter(filter_file_path);

//设置滤镜强度
//val:滤镜强度
rtc_engine_->setBeautyFilterLevel(val);

//取消滤镜效果
rtc_engine_->removeBeautyFilter();

//关闭美颜功能
rtc_engine_->enableBeauty(false);

//结束美颜，释放美颜库资源
rtc_engine_->stopBeauty();

```