在金融行业等对用户隐私数据要求较高的行业场景中，往往需要额外采用媒体流加密方式保障用户数据在网络传输过程中的安全性、保障用户的信息安全和数据安全。网易云信在默认加密算法的基础上，提供了内置国密加密方案，进一步保障数据安全。

## 方案架构

![](https://yx-web-nosdn.netease.im/quickhtml%2Fassets%2Fyunxin%2Fdoc%2FG2-Encryption01.png)

- 您的服务端生成密钥并加密传输给客户端。
- 用户 A 采集音视频流之后，通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/unity/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine.html#af76b8c1cccd99d9deb60fd360f382cf6" target="_blank">`EnableEncryption`</a> 接口启用加密并传入加密模式和密钥，将加密后的音视频流传输到网易云信音视频服务。
- 网易云信音视频服务中转加密的音视频流。
- 用户 B 收到音视频流之后，通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/unity/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine.html#af76b8c1cccd99d9deb60fd360f382cf6" target="_blank">`EnableEncryption`</a> 接口传入加密模式和密钥，解密媒体流，并解码与渲染。

## 注意事项

- 同一房间内，所有开启媒体流加密的用户必须使用相同的加密模式和密钥，否则使用不同密钥的成员加入房间时会报错 `kNERtcErrEncryptNotSuitable`（30113）。
- 安全起见，建议每次启用媒体流加密时都更换新的密钥。

## 实现方法

### **配置步骤**

1. 在您的服务端生成密钥。

    参考以下命令通过 OpenSSL 随机生成 String 型、16 字节的密钥。

    ```C#
    // 随机生成一个 String 型、16 字节的密钥，并将该密钥传入 EnableEncryption 的 config 参数
    openssl rand -hex 16
    dba643c8ba6b6dc738df43d9fd624293b4b12d87a60f518253bd10ba98c48453
    ```

2. 客户端从服务端获取 String 型密钥后，在加入房间前，调用 <a href="https://doc.yunxin.163.com/nertc/api-refer/unity/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine.html#af76b8c1cccd99d9deb60fd360f382cf6" target="_blank">`EnableEncryption`</a> 方法开启媒体流加密功能，并设置加密模式和密钥。

    ::: note note
    - 加密模式目前仅支持国密 SM4 对称加密算法。
    - 同一房间内，所有开启媒体流加密的用户必须使用相同的加密模式和密钥，否则使用不同密钥的成员加入房间时会报错 `kNERtcErrEncryptNotSuitable`（30113）。
    :::

### **示例代码**

```C#
//媒体流加密
private void enableEncryption()
{
    var config = new RtcEncryptionConfig
    {
        key = "YOUR ENCRYPTION KEY",
        mode = RtcEncryptionMode.kNERtcGMCryptoSM4ECB
    };
    int result = rtcEngine.EnableEncryption(true, config);
    if (result != (int)RtcErrorCode.kNERtcNoError)
    {
        //失败
    }
}
```