<!--keywords: 音视频通话,监测发言者音量,人声 -->

在语音连麦、视频会议等场景中，开发者应用层常常需要了解到发言者的人声相关信息，从而做出 UI 上的音量展示或根据发言者的音量大小进行视图布局的动态调整。

<img style="width:400px" src=" https://yx-web-nosdn.netease.im/common/6e7f514baa00ca5efbfb3f2c31cf7d74/音量提示.png " alt="文本">

NERTC SDK 提供监听房间内用户发送的音量值的功能，同时监听本端用户的音频数据中是否存在有效的人声信息。

## 功能介绍
NERTC SDK 支持根据您设置的时间间隔，定期通过回调返回本端发流用户的瞬时音量值以及是否存在人声，同时返回最多三位瞬时音量最高的远端用户的相关音量信息，即当前正在发言的用户 ID 和用户音频主流及辅流的瞬时音量值。



## 注意事项
- 若本端用户调用 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#ae5a9a1261702039d9d636997706de7e8" target="_blank">`muteLocalAudioStream`</a> 方法静音本地音频，SDK 会将音量设置为 0 后通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#a25c574a4dd4ed626b92a0f07002edc3e" target="_blank">`onLocalAudioVolumeIndication`</a> 回调返回静音信息，但此回调默认禁用，只可通过 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#afc6ac753580afdfc61470684826ba9f4" target="_blank">`enableAudioVolumeIndication`</a> 方法开启。
- 成功启用人声监测功能后，无论房间内是否有人发言，SDK 都会按指定的时间间隔触发 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#a25c574a4dd4ed626b92a0f07002edc3e" target="_blank">`onLocalAudioVolumeIndication`</a> 和 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#afa31900f2f11e64e6c4e2811991d4bbe" target="_blank">`onRemoteAudioVolumeIndication`</a> 回调。
- 返回的 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#afa31900f2f11e64e6c4e2811991d4bbe" target="_blank">`onRemoteAudioVolumeIndication`</a> 回调中，若 speakers 数组为空，则表示此时远端没有上行的音频主流或辅流数据；若上次返回的数组中出现的 uid 不在本次返回的数组中，则默认该 uid 对应的远端用户没有发言。

## 实现方法

1. 调用 <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#afc6ac753580afdfc61470684826ba9f4" target="_blank">`enableAudioVolumeIndication`</a> 方法，启用发言者的人声监测。
    ::: note note
    音量提示的时间间隔值必须设置为 100 毫秒的整数倍，建议设置为 200 毫秒及以上。
    :::
2. 成功启用人声监测功能后，SDK 返回以下回调通知：
    - <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#a25c574a4dd4ed626b92a0f07002edc3e" target="_blank">`onLocalAudioVolumeIndication`</a>：房间内本地用户瞬时音量的回调，及提示是否检测到人声。
    - <a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#afa31900f2f11e64e6c4e2811991d4bbe" target="_blank">`onRemoteAudioVolumeIndication`</a>：房间内正在发言的用户 ID 及用户音频主流和辅流的瞬时音量的回调。

## 示例代码

```c++
//启用说话者音量提示,在 onRemoteAudioVolumeIndication 和 onRemoteAudioVolumeIndication 回调中每隔 200ms 返回音量提示  
nertc_engine_->enableAudioVolumeIndication(enable, 200, enable);   

//提示房间内本地用户瞬时音量以及是否检测到人声的回调
void YourProjectClass::onLocalAudioVolumeIndication(int volume, bool enable_vad)
{
    printf("AudioVolume: volume: %d\n", volume);
}

//提示房间内谁正在说话及说话者瞬时音量的回调，包括主流音量 volume 和辅流音量 subStreamVolume
void YourProjectClass::onRemoteAudioVolumeIndication(const NERtcAudioVolumeInfo *speakers, unsigned int speaker_number, int total_volume)
{
    for (unsigned int i = 0; i < speaker_number; i++)
    {
        nertc::NERtcAudioVolumeInfo stats = speakers[i];
        printf("uid:%lld, AudioVolume: volume: %d\n",
            stats.uid, stats.volume, stats.subStreamVolume);
    }
}
```

## API 参考
| **方法** | **功能描述**|
|:--|:--|
|<a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#afc6ac753580afdfc61470684826ba9f4" target="_blank">`enableAudioVolumeIndication`</a>|启用发言者的人声监测。|
|<a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#a25c574a4dd4ed626b92a0f07002edc3e" target="_blank">`onLocalAudioVolumeIndication`</a>|房间内本地用户瞬时音量的回调，及提示是否检测到人声。|
|<a href="https://doc.yunxin.163.com/nertc/api-refer/UE/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_event_handler.html#afa31900f2f11e64e6c4e2811991d4bbe" target="_blank">`onRemoteAudioVolumeIndication`</a>|房间内正在发言的用户 ID 及用户瞬时音量的回调。|