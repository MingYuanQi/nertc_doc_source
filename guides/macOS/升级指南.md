本文介绍 NERTC SDK 5.X.X 版本，macOS 端升级的说明和注意事项。

## 5.6.50

从 5.6.50 版本起，NERTC SDK 支持 XCFramework 框架格式。XCFramework 是 Apple 在 Xcode 11 中引入的一种新的框架格式，用于简化和优化在不同平台（如 iOS、macOS、watchOS 和 tvOS）上使用的二进制库的管理和分发。

从 5.6.40 升级至 5.6.50 版本，如果您需要 [手动集成 NERTC SDK](https://doc.yunxin.163.com/nertc/guide/DI3NDEyNDI?platform=macOS#%E6%96%B9%E5%BC%8F%E4%BA%8C%E6%89%8B%E5%8A%A8%E9%9B%86%E6%88%90)，请重新添加 XCFramework 的依赖。

## 5.6.40

从 5.6.30 升级至 5.6.40 版本，针对构建了多房间功能的用户需注意，多房间场景下的接口行为变更如下：

- 本地音频采集和发送接口 [`enableLocalAudio`](https://doc.yunxin.163.com/nertc/references/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_channel.html#ac746f2cd380bbfeee1a0d56957a387aa) 打开音频设备时，行为互斥修改为不互斥。
- 本地媒体流（主流）的发送接口 [`enableMediaPub`](https://doc.yunxin.163.com/nertc/references/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_channel.html#add4150cf7de0bec23523a216c978245c) 发布音频流时，行为不互斥修改为互斥。

即在多房间下实现发送音频流，如果只需保持设备按需开启，您需要：

1. 先关闭上一个房间的音频流，即 `enableMediaPub`=`false` / `enableLocalAudio`=`false`。
2. 然后在当前房间实现发送音频数据流，即 `enableMediaPub`=`true` / `enableLocalAudio`=`true`。

在多房间下实现发送音频流，如果需要音频采集设备一直开启，您需要：

1. 在成员加入每个房间前，调用一次 `enableLocalAudio`。
2. 后续音频流发布到具体的房间只需由 `enableMediaPub` 控制。

## 5.5.10

从 5.5.2 升级至 5.5.10 版本，涉及如下接口变更，您需要结合实际业务场景更新相关的 App 代码：

**接口名称变更**

| 功能 | 原接口 | 新接口 | 集成修改建议 |
| ---- | ---- |
| 设置空间音效的距离衰减属性和语音范围 | `UpdateSpatializerAudioRecvRange` | [`setAudioRecvRange`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#aa2a512b95a1f7e63f7badbcee4bcf9c8) | 若您使用了 **空间音效** 功能，请修改代码中对应的接口名称。
| 设置空间音效中说话者和接收者的空间位置信息 | `UpdateSpatializerSelfPosition` | [`updateSelfPosition`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#a7d1e68f02ce3128fd85837bd431cce1f) | ^^
| 空间位置信息 | `NERtcSpatializerPositionInfo` | [`NERtcPositionInfo`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/structnertc_1_1_n_e_rtc_position_info.html) | 若您使用了 **空间音效** 功能，请修改代码中对应的结构体名称。

**接口行为变更**

| 变更描述 | 集成修改建议 |
| ---- | ---- |
| 切换房间（`switchChannel`）。在直播场景中，原先只支持观众切换房间，修改为主播和观众都支持切换房间，并且切换后会保持切换前的音视频的状态。 | 请检查房间切换前后的音视频状态是否符合预期。 |
| `onFirstVideoFrameDecoded` 回调的触发时机修改，当重新调用 `enableLocalVideo` 开启本地视频采集，或停止屏幕共享后再重新调用 `startScreenCapture` 接口共享屏幕时，都会触发该回调。 | 不影响 |

## 5.3.1

从 4.6.X 升级至 5.3.1 版本，涉及如下接口变更，您需要结合实际业务场景更新相关的 App 代码：

**接口行为变更**

| 变更描述 | 集成修改建议 |
| ---- | ---- |
| 支持在不开麦的状态下默认开启伴音功能。 | 若您在 [setParameters](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#a4d39a81643f19979461ec0bb569f4a0d) 中设置了不开麦状态下开启伴音功能的开关(kNERtcKeyAudioMixSendEnabledWithoutMic)，删除相关代码片段即可。 |
| 观众调用 `addLiveStreamTask` 方法添加房间推流任务，无需跟服务器进行信令交互，直接返回 30005。 | 根据返回的 30005 错误码直接判断当前角色不正确。 |
| 开启屏幕共享接口 `startScreenCapture` 与开启本地视频辅流通道接口 [`enableLocalVideo`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_channel.html#a5c336b19e3c9b0db9a73b9515d7108d7) 互斥。 | <ul><li>如果当前正在屏幕共享，调用 [`enableLocalVideo`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_channel.html#a5c336b19e3c9b0db9a73b9515d7108d7) 开启辅流时，需要调用 `stopScreenCapture` 先停止屏幕共享。<li>如果当前正在使用本地视频辅流通道进行本地摄像头采集或者外部自定义视频输入，调用 `startScreenCapture` 开启屏幕共享时，需要先调用 [`enableLocalVideo`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_channel.html#a5c336b19e3c9b0db9a73b9515d7108d7) 停止辅流。 |
| 视频采集数据回调 `onCaptureVideoFrame` 默认关闭。 | 若您使用了视频采集数据回调功能，请先调用 [`setParameter(key：kNERtcKeyEnableVideoCaptureObserver)`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/Latest/zh/html/classnertc_1_1_i_rtc_engine_ex.html#a4d39a81643f19979461ec0bb569f4a0d) 方法开启此回调。
| 日志的默认存放路径变更。 | Windows 端的默认日志路径调整为：exe 同级目录下的 logs 文件夹。

**接口参数变更**

| 变更描述 | 集成修改建议 |
| ---- | ---- |
| 编码水印 [`setLocalVideoWatermarkConfigs`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/V5.3.1/zh/html/classnertc_1_1_i_rtc_engine_ex.html#a45ecd234816646e288e420f0a3a4b346)    接口中，`NERtcVideoWatermarkTextConfig` 和 `NERtcVideoWatermarkTimestampConfig` 结构体里的 `fontPath` 名字改为 `fontName`。 | 若您使用了 **编码水印** 功能，请修改代码中对应的参数。 |
| 废弃 [`NERtcEngineContext`](https://doc.yunxin.163.com/nertc/api-refer/macOS/doxygen/V5.3.1/zh/html/structnertc_1_1_n_e_rtc_engine_context.html) 里的 `log_file_max_size_KBytes` 字段。 | 删除相关字段。 |